import argparse
import logging

import tool.defaults as defaults


def handle_cmdline():
    # TODO: add help messages
    parser = argparse.ArgumentParser(formatter_class=argparse.ArgumentDefaultsHelpFormatter)
    parser.add_argument("--log", default="info", choices=["critical", "error", "warning", "info", "debug"], help="TODO")
    # TODO: introduce stages (query, filter_isol, variations, filter_?, write, generate,...)
    parser.add_argument("--until", type=int, default=None, choices=[0, 1, 2, 3], help="TODO")
    parser.add_argument("--times", action="store_true", help="TODO")
    parser.add_argument("--progress", action="store_true", help="TODO")
    parser.add_argument("--host", default="localhost", help="TODO")
    parser.add_argument("--port", type=int, default=7687, help="TODO")
    parser.add_argument("--session", default="default", help="TODO")
    parser.add_argument("--limit-results", type=int, default=None, help="TODO")
    parser.add_argument("--min-inputs", type=int, default=0, help="TODO")
    parser.add_argument("--max-inputs", type=int, default=3, help="TODO")
    parser.add_argument("--min-outputs", type=int, default=0, help="TODO")
    parser.add_argument("--max-outputs", type=int, default=2, help="TODO")
    # TODO: --max-constants
    parser.add_argument("--max-nodes", type=int, default=5, help="TODO")
    parser.add_argument("--max-enc-footprint", type=float, default=defaults.MAX_ENC_FOOTPRINT_DEFAULT, help="TODO")
    parser.add_argument("--max-enc-weight", type=float, default=defaults.MAX_ENC_WEIGHT_DEFAULT, help="TODO")
    parser.add_argument("--min-enc-bits-left", type=int, default=defaults.MIN_ENC_BITS_LEFT_DEFAULT, help="TODO")
    parser.add_argument("--min-nodes", type=int, default=1, help="TODO")
    parser.add_argument("--min-path-length", type=int, default=1, help="TODO")
    parser.add_argument("--max-path-length", type=int, default=3, help="TODO")
    parser.add_argument("--max-path-width", type=int, default=2, help="TODO")
    parser.add_argument("--instr-predicates", type=int, default=defaults.INSTR_PREDICATES_DEFAULT, help="TODO")
    parser.add_argument("--function", "--func", default=None, help="TODO")
    parser.add_argument("--basic-block", "--bb", default=None, help="TODO")
    parser.add_argument("--stage", type=int, default=defaults.STAGE_DEFAULT, help="TODO")
    parser.add_argument("--ignore-names", default=",".join(defaults.IGNORE_NAMES_DEFAULT), help="TODO")
    parser.add_argument("--ignore-op-types", default=",".join(defaults.IGNORE_OP_TYPES_DEFAULT), help="TODO")
    parser.add_argument("--ignore-const-inputs", action="store_true", help="TODO")
    parser.add_argument("--xlen", type=int, default=64, help="TODO")
    parser.add_argument("--output-dir", "-o", default="./out", help="TODO")
    parser.add_argument("--write-func", action="store_true", help="TODO")
    parser.add_argument("--write-func-fmt", type=int, default=defaults.FUNC_FMT_DEFAULT, help="TODO")
    # parser.add_argument("--write-func-flt", type=int, default=FUNC_FLT_DEFAULT, help="TODO")
    parser.add_argument("--write-sub", action="store_true", help="TODO")
    parser.add_argument("--write-sub-fmt", type=int, default=defaults.SUB_FMT_DEFAULT, help="TODO")
    parser.add_argument("--write-sub-flt", type=int, default=defaults.SUB_FLT_DEFAULT, help="TODO")
    parser.add_argument("--write-io-sub", action="store_true", help="TODO")
    parser.add_argument("--write-io-sub-fmt", type=int, default=defaults.IO_SUB_FMT_DEFAULT, help="TODO")
    parser.add_argument("--write-io-sub-flt", type=int, default=defaults.IO_SUB_FLT_DEFAULT, help="TODO")
    parser.add_argument("--write-tree", action="store_true", help="TODO")
    parser.add_argument("--write-tree-fmt", type=int, default=defaults.TREE_FMT_DEFAULT, help="TODO")
    parser.add_argument("--write-tree-flt", type=int, default=defaults.TREE_FLT_DEFAULT, help="TODO")
    parser.add_argument("--write-gen", action="store_true", help="TODO")
    parser.add_argument("--write-gen-fmt", type=int, default=defaults.GEN_FMT_DEFAULT, help="TODO")
    parser.add_argument("--write-gen-flt", type=int, default=defaults.GEN_FLT_DEFAULT, help="TODO")
    parser.add_argument("--write-pie", action="store_true", help="TODO")
    parser.add_argument("--write-pie-fmt", type=int, default=defaults.PIE_FMT_DEFAULT, help="TODO")
    parser.add_argument("--write-pie-flt", type=int, default=defaults.PIE_FLT_DEFAULT, help="TODO")
    parser.add_argument("--write-sankey", action="store_true", help="TODO")
    parser.add_argument("--write-sankey-fmt", type=int, default=defaults.SANKEY_FMT_DEFAULT, help="TODO")
    parser.add_argument("--write-sankey-flt", type=int, default=defaults.SANKEY_FLT_DEFAULT, help="TODO")
    parser.add_argument("--write-df", action="store_true", help="TODO")
    parser.add_argument("--write-df-fmt", type=int, default=defaults.DF_FMT_DEFAULT, help="TODO")
    parser.add_argument("--write-df-flt", type=int, default=defaults.DF_FLT_DEFAULT, help="TODO")
    parser.add_argument("--write-index", action="store_true", help="TODO")
    parser.add_argument("--write-index-fmt", type=int, default=defaults.INDEX_FMT_DEFAULT, help="TODO")
    parser.add_argument("--write-index-flt", type=int, default=defaults.INDEX_FLT_DEFAULT, help="TODO")
    parser.add_argument("--write-queries", action="store_true", help="TODO")
    parser.add_argument("--write-query-metrics", action="store_true", help="TODO")
    parser.add_argument("--allowed-enc-sizes", type=int, nargs="+", default=defaults.ALLOWED_ENC_SIZES_DEFAULT, help="TODO")
    parser.add_argument(
        "--allowed-imm_widths", type=int, nargs="+", default=defaults.ALLOWED_IMM_WIDTHS, help="TODO"
    )  # TODO: use
    parser.add_argument("--min-iso-weight", type=float, default=defaults.MIN_ISO_WEIGHT_DEFAULT, help="TODO")
    parser.add_argument("--max-loads", type=int, default=defaults.MAX_LOADS_DEFAULT, help="TODO")
    parser.add_argument("--max-stores", type=int, default=defaults.MAX_STORES_DEFAULT, help="TODO")
    parser.add_argument("--max-mems", type=int, default=defaults.MAX_MEMS_DEFAULT, help="TODO")
    parser.add_argument("--max-branches", type=int, default=defaults.MAX_BRANCHES_DEFAULT, help="TODO")
    parser.add_argument("--max-operands", type=int, default=defaults.MAX_OPERANDS_DEFAULT, help="TODO")
    parser.add_argument("--max-reg-operands", type=int, default=defaults.MAX_REG_OPERANDS_DEFAULT, help="TODO")
    parser.add_argument("--max-imm-operands", type=int, default=defaults.MAX_IMM_OPERANDS_DEFAULT, help="TODO")  # TODO: use
    parser.add_argument("--enable-variation-reuse-io", action="store_true", help="TODO")
    parser.add_argument("--halt-on-error", action="store_true", help="TODO")
    args = parser.parse_args()
    logging.basicConfig(level=getattr(logging, args.log.upper()))
    logging.getLogger("neo4j.io").setLevel(logging.INFO)
    logging.getLogger("neo4j.pool").setLevel(logging.INFO)
    return args
